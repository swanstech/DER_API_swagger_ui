from fastapi import APIRouter, Form, HTTPException, Header, Query
import requests


pentest = APIRouter(prefix="/pentest", tags=["pentest"])

PENTEST_RESULTS_URL = "https://agicb429v2.execute-api.ap-southeast-2.amazonaws.com/pentest/DER_API_pentest_results"

@pentest.get("/get_test_result")
def get_pentest_results(
    customer_id: str = Query(..., description="customer_id"),
    auth_token: str = Header(..., alias="auth-token"),
):
    headers = {
        "auth-token": auth_token
    }

    params = {
        "customer_id": customer_id
    }

    resp = requests.get(
        PENTEST_RESULTS_URL,
        headers=headers,
        params=params,
        timeout=10,
    )

    if resp.status_code != 200:
        raise HTTPException(status_code=resp.status_code, detail=resp.text)

    return resp.json()
